#!/usr/bin/env bash
set -e
SUBJECT="${1}"
COMPAT="${2}"
SCHEMA_REGISTRY_HOST_AND_PORT="${3-http://localhost:8081}"

echoerr() { printf "%s\n" "$*" >&2; }

[[ "$#" -lt "2" ]] && (echoerr "Usage: $0 [schema-subject-name] [compat] [schema-registry-host-and-port]"; exit 1;)

PAYLOAD="$(jq -n --arg schema "$AVRO_SCHEMA_DATA" '{schema: $schema}')"
curl --silent \
    -X PUT \
    -H "Content-Type: application/json" \
    --data "{\"compatibility\": \"${COMPAT}\"}" \
    "${SCHEMA_REGISTRY_HOST_AND_PORT}/config/$SUBJECT"
